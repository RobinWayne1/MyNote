# 第二章 文件

### 一.参数文件

my.cnf

### 二.日志文件

#### 1.错误日志

#### 2.慢查询日志

#### 3.查询日志

#### 4.二进制日志

binlog记录了对MySQL数据库执行更改的所有操作,若操作本身并没有导致数据库发生变化,那么该操作可能也会写入二进制日志。

binlog的作用：

* 恢复
* 复制
* 审计：通过二进制日志中的信息判断是否有对数据库进行注入攻击

当使用事务的表存储引擎时，所有未提交的二进制日志会被记录到一个缓存中去，等待**==事务提交时直接将缓冲中的二进制日志写入二进制日志文件==**，而该缓冲由binlog_cache_size决定。==**当一个线程开始一个事务时，MySQL会自动分配一个大小为binlog_cache_size的缓存，所以该值不能设置过大。**==当一个事务的记录大于binlog_cache_size时，MySQL会把缓冲中的日志写入一个临时文件中，所以又不能设置太小。

在默认情况下，**binlog并不是在==每次事务==提交的时候同步到磁盘**，因此当数据库所在操作系统发生宕机时有可能会有一部分数据没有写入到二进制日志文件中，设置sync_binlog=1**（详细一点）**表示采用同步写磁盘的方式来写二进制日志

**==binlog_format:==**

* statement:binlog记录的是日志的逻辑SQL语句
* ROW:对statement的rand,uuid等函数的不一致问题予以解决——记录表的行更改情况
* MIXED：默认采用statement，但在一些情况下会使用ROW格式

注：ROW会带来binlog大小的增加

### 二.InnoDB存储引擎文件

#### 1.表空间文件

InnoDB采用将存储的数据按表空间进行存放的设计,默认将所有表的数据存储于共享表空间中。若设置了参数innodb_file_per_table，则用户可以将**每个基于InnoDB存储引擎的表**产生一个独立表空间。

注：单独表空间只存储该表的数据、索引和insert buffer bitmap等信息、其余信息还是存放在默认共享表空间中。

#### 2.重做日志文件

重做日志文件记录了对于InnoDB存储引擎的事务日志

同样是记录事务日志，==**⭐二进制日志和重做日志的区别：**==

* 二进制日志会记录所有与MySQL数据库有关的日志内容，包括InnoDB、MyISAM、Heap等存储引擎的日志。而InnoDB存储引擎的重做日志只记录有关该存储引擎本身的事务日志。
* 记录的内容不同。无论binlog的记录格式设为STATEMENT、ROW还是MIXED，其记录的都是关于一个事务的具体操作内容，**==即该日志是逻辑日志==**(即对行记录的DDL\DML操作)。而重做日志文件记录的是关于每个页的更改的**==物理情况(偏移量等)==**。

* 写入时间不同。二进制日志文件仅再事务提交前提交，即只写磁盘一次，不论该事务有多大。而在事务进行的过程中，却不断有重做日志条目被写入到重做日志文件中

从重做日志缓冲往磁盘写入时，是按一个扇区的大小进行写入。因为扇区是写入的最小单位，因此可以保证写入必定是成功的。因此在重做日志的写入过程中不需要有doublewrite。

