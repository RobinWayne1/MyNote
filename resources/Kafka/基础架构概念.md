# 基础架构概念

## 一、三大特点





## 二、架构

### Ⅰ、Producer：生产者

### Ⅱ、Consumer：消费者

### Ⅲ、Broker：服务代理节点

`Broker`相当于一个独立的Kafka节点,一个或多个`Broker`组成了Kafka集群。

### Ⅳ、Topic：主题

主题是一个逻辑上的概念，生产者将消息发送到某个主题中，消费者订阅这个主题则能够获取到消息，所以对于生产者和消费者来说，主题相当于消息存储的基本单位。

### ==Ⅴ、Partition：分区==

分区是这里最重要的概念。刚刚上面说到主题是一个逻辑上的概念，**因为对于Kafka来说，消息的存储单位是分区。一个主题可以有多个分区，而每个分区只属于一个主题。**

![](E:\Typora\MyNote\resources\Kafka\分区消息追加.png)

特点：

1. 分区在存储层面可以看成一个可追加的日志文件。消息在追加到分区日志文件时会分配一个偏移量（`offset`），==`offset`是消息在分区的唯一标识。**也就是说，Kafka只保证分区内的消息有序性。**==

2. Kafka中的分区可以分布在不同的`Broker`上,也就是说一个`Topic`可以横跨多个`Broker`。**每一条消息在发送到`Broker`之前，都会根据分区规则选择存储到哪个分区，如果该主题分区在不同的`Broker`中,则可以达到负载均衡的目的。**

3. **==高可用特点==**
    
    1. ![](E:\Typora\MyNote\resources\Kafka\多副本架构.png)
    
         ==**Kafka为分区引入了多副本（Replica）机制。**==一个分区中的多个副本是一主多从的关系，并且各个副本之间的数据理论上是应该保持一致的。==其中主分区`leader`负责处理读写的请求,而从分区`follower`只负责同步`leader`的数据。副本处于不同的 broker 中==，**当 leader 副本出现故障时，从` follower` 副本中重新选举 新的 `leader` 副本对外提供服务。** Kafka 通过多副本机制实现了故障的自动转移，当 Kafka 集群中 某个 broker 失效时仍然能保证服务可用 。
    
    2.  Consumer 使用拉（Pull）模式从服务端拉取消息，**并且保存消费的具体位置**， 当消费者宕机**恢复上线时可以根据之前保存的消费位置重新拉取需要的消息进行消费，这样就不会造成消息丢失。**