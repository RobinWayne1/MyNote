# 平衡二叉树

## 一、平衡二叉树的定义

1. 条件一：它必须是二叉查找树。
2. 条件二：每个节点的左子树和右子树的高度差至多为1。

## 二、平衡二叉树的相关概念

**平衡因子**：将二叉树上节点的左子树高度减去右子树高度的值称为该节点的平衡因子BF(Balance Factor)。

如下图

![](E:\Typora\MyNote\resources\数据结构\平衡因子概念.png)

如插入43后45这个结点的平衡因子就变为了2，此时这个树就不平衡了。

## 三、平衡二叉树插入失衡调整

相较于红黑树比较简单，四种情况

### Ⅰ、情况一：左单旋转

![](E:\Typora\MyNote\resources\数据结构\左单旋转.png)

要注意旋转的都是平衡因子>1的左子节点和右子节点。

### Ⅱ、情况二：右单旋转

![](E:\Typora\MyNote\resources\数据结构\右单旋转.png)

### Ⅲ、情况三：先右旋后左旋

![](E:\Typora\MyNote\resources\数据结构\先右旋后左旋.png)### 



### Ⅳ、情况四：先左旋后右旋

![](E:\Typora\MyNote\resources\数据结构\先左旋后右旋.png)

## 四、删除操作

删除节点时，如果节点同时拥有左子树和右子树，则在高度较低的子树上选择（左子树）最大（或右子树最小）元素进行替换，这样能保证替换后不会再出现失衡的现象。

## 五、与红黑树对比（主要说插入删除效率）

1. 红黑树不追求"完全平衡"，即不像AVL那样要求节点的 `|balFact| <= 1`，它只要求部分达到平衡，但是提出了为节点增加颜色，红黑是用非严格的平衡来换取增删节点时候旋转次数的降低，任何不平衡都会在三次旋转之内解决，而AVL是严格平衡树，因此在增加或者删除节点的时候，根据不同情况，旋转的次数比红黑树要多。
2. 就插入节点导致树失衡的情况，AVL和RB-Tree都是最多两次树旋转来实现复衡rebalance，旋转的量级是O(1)
    删除节点导致失衡，AVL需要维护从被删除节点到根节点root这条路径上所有节点的平衡，旋转的量级为O(logN)，而RB-Tree最多只需要旋转3次实现复衡，只需O(1)，所以说RB-Tree删除节点的rebalance的效率更高，开销更小！
3. AVL的结构相较于RB-Tree更为平衡，插入和删除引起失衡，如2所述，RB-Tree复衡效率更高；当然，由于AVL高度平衡，因此AVL的Search效率更高啦。
4. 针对插入和删除节点导致失衡后的rebalance操作，红黑树能够提供一个比较"便宜"的解决方案，降低开销，是对search，insert ，以及delete效率的折衷，总体来说，RB-Tree的统计性能高于AVL.
5. 故引入RB-Tree是**功能、性能、空间开销的折中结果**。
    5.1 AVL更平衡，结构上更加直观，时间效能针对读取而言更高；维护稍慢，空间开销较大。
    5.2 红黑树，读取略逊于AVL，维护强于AVL，空间开销与AVL类似，内容极多时略优于AVL，维护优于AVL。
    基本上主要的几种平衡树看来，**红黑树有着良好的稳定性和完整的功能，性能表现也很不错，综合实力强**，在诸如STL的场景中需要稳定表现。

6. 总结：实际应用中，若搜索的次数远远大于插入和删除，那么选择AVL，如果搜索，插入删除次数几乎差不多，应该选择RB。

